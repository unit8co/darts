
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Anomaly Detection Darts Module &#8212; darts  documentation</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../_static/docs-favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Dynamic Time Warping (DTW)" href="12-Dynamic-Time-Warping-example.html" />
    <link rel="prev" title="Filtering and predicting using the Gaussian Process filter" href="11-GP-filter-examples.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/darts-logo-trim.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../README.html">
  Home
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../quickstart/00-quickstart.html">
  Quickstart
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../userguide.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../generated_api/darts.html">
  API Reference
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../examples.html">
  Examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../release_notes/RELEASE_NOTES.html">
  Release Notes
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/unit8co/darts" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/unit8co" rel="noopener" target="_blank" title="Twitter">
            <span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01-multi-time-series-and-covariates.html">
   Multiple Time Series, Pre-trained Models and Covariates
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="02-data-processing.html">
   Data (pre) processing using
   <code class="docutils literal notranslate">
    <span class="pre">
     DataTransformer
    </span>
   </code>
   and
   <code class="docutils literal notranslate">
    <span class="pre">
     Pipeline
    </span>
   </code>
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="15-static-covariates.html">
   Static Covariates
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="14-transfer-learning.html">
   Transfer Learning for Time Series Forecasting with Darts
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="16-hierarchical-reconciliation.html">
   Hierarchical Reconciliation - Example on the Australian Tourism Dataset
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="17-hyperparameter-optimization.html">
   Hyper-parameters Optimization for Electricity Load Forecasting
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="20-SKLearnModel-examples.html">
   Regression Models
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="24-SKLearnClassifierModel-examples.html">
   Classification Models
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="23-Conformal-Prediction-examples.html">
   Conformal Prediction Models
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="03-FFT-examples.html">
   Fast Fourier Transform Forecasting Model (FFT)
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="04-RNN-examples.html">
   Recurrent Neural Networks Models
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="05-TCN-examples.html">
   Temporal Convolutional Network
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="06-Transformer-examples.html">
   Transformer Model
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="07-NBEATS-examples.html">
   N-BEATS
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="08-DeepAR-examples.html">
   Probabilistic RNN
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="09-DeepTCN-examples.html">
   DeepTCN model
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="13-TFT-examples.html">
   Temporal Fusion Transformer
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="18-TiDE-examples.html">
   TimeSeries Deep Encoder
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="21-TSMixer-examples.html">
   Time Series Mixer (TSMixer)
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="19-EnsembleModel-examples.html">
   Ensembling Models
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="10-Kalman-filter-examples.html">
   Filtering and predicting using the darts filters
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="11-GP-filter-examples.html">
   Filtering and predicting using the Gaussian Process filter
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Anomaly Detection Darts Module
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="12-Dynamic-Time-Warping-example.html">
   Dynamic Time Warping (DTW)
  </a>
 </li>
</ul>

  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Anomaly Detection Darts Module
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Anomaly-Model:-Taxi-passengers-in-NY">
   Anomaly Model: Taxi passengers in NY
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Load-and-visualize-the-data">
     Load and visualize the data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Train-a-Darts-forecasting-model">
     Train a Darts forecasting model
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Use-a-Forecasting-Anomaly-Model">
     Use a Forecasting Anomaly Model
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#Using-the-main-functions:-fit(),-score(),-eval_metric()-and-show_anomalies()">
       Using the main functions: fit(), score(), eval_metric() and show_anomalies()
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Convert-an-anomaly-score-to-a-binary-prediction-with-a-Detector">
   Convert an anomaly score to a binary prediction with a
   <code class="docutils literal notranslate">
    <span class="pre">
     Detector
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#A-zoom-on-each-anomalies:-visualize-the-results">
   A zoom on each anomalies: visualize the results
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Simple-case:-KMeansScorer">
   Simple case:
   <code class="docutils literal notranslate">
    <span class="pre">
     KMeansScorer
    </span>
   </code>
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Multivariate-case-with-window=1">
     Multivariate case with window=1
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#Synthetic-data-creation">
       Synthetic data creation
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#Train-set">
         Train set
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#Test-set">
         Test set
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#Use-the-scorer-KMeansScorer()">
       Use the scorer
       <code class="docutils literal notranslate">
        <span class="pre">
         KMeansScorer()
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Univariate-case-with-window&gt;1">
     Univariate case with window&gt;1
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Synthetic data creation
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id2">
         Train set
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id3">
         Test set
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id4">
       Use the scorer
       <code class="docutils literal notranslate">
        <span class="pre">
         KMeansScorer()
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Anomaly-Detection-Darts-Module">
<h1>Anomaly Detection Darts Module<a class="headerlink" href="#Anomaly-Detection-Darts-Module" title="Permalink to this heading">¶</a></h1>
<p>This notebook showcases some of the functionalities of Darts’ Anomaly Detection Module. We’ll look at Anomaly Scorers, Detectors, Aggregators and Anomaly Models.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Scorers</span></code>: compute anomaly scores time series, either only on the target series or between the target series and a forecasted/predicted series. They are the core of the anomaly detection module.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Detectors</span></code>: transform time series (such as anomaly scores) into binary anomaly time series. The presence of an anomaly is flagged with <code class="docutils literal notranslate"><span class="pre">1</span></code>, and <code class="docutils literal notranslate"><span class="pre">0</span></code> otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Aggregators</span></code>: reduce a multivariate binary time series (e.g., where each component represents the anomaly score of a different series component/model) into a univariate binary time series.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Anomaly</span> <span class="pre">Models</span></code>: offer a convenient way to produce anomaly scores from any of Darts’ global forecasting models or filtering models by comparing the models’ predictions with actual observations. Each Anomaly Model takes one forecasting/filtering model and one or multiple scorers. The model produces some predictions, which are fed together with the actual series to the scorer(s). It will return anomaly scores for each scorer.</p></li>
</ul>
<p>The figure below illustrates the different input/output for each tool:</p>
<p><img alt="5e4fc0dc85e84c36ace8060679c326b9" class="no-scaled-link" src="../_images/ad_4_sub_modules.png" style="width: 800px;" /></p>
<p>The notebook is devided into two sections:</p>
<ul class="simple">
<li><p>How to use <code class="docutils literal notranslate"><span class="pre">ForecastingAnomalyModel</span></code> to find anomalies in the number of taxi passengers in New York.</p></li>
<li><p>How to use an <code class="docutils literal notranslate"><span class="pre">AnomalyScorer</span></code> and the importance of its windowing capabilities on two toy datasets.</p></li>
</ul>
<p>First, some necessary imports:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># fix python path if working locally</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">fix_pythonpath_if_working_locally</span>

<span class="n">fix_pythonpath_if_working_locally</span><span class="p">()</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">darts</span><span class="w"> </span><span class="kn">import</span> <span class="n">TimeSeries</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">darts.ad</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">ForecastingAnomalyModel</span><span class="p">,</span>
    <span class="n">KMeansScorer</span><span class="p">,</span>
    <span class="n">NormScorer</span><span class="p">,</span>
    <span class="n">WassersteinScorer</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">darts.ad.utils</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">eval_metric_from_scores</span><span class="p">,</span>
    <span class="n">show_anomalies_from_scores</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">darts.dataprocessing.transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">Scaler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">darts.datasets</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaxiNewYorkDataset</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">darts.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">mae</span><span class="p">,</span> <span class="n">rmse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">darts.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">SKLearnModel</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/dennisbader/miniconda3/envs/darts310_test/lib/python3.10/site-packages/statsforecast/utils.py:237: FutureWarning: &#39;M&#39; is deprecated and will be removed in a future version, please use &#39;ME&#39; instead.
  &#34;ds&#34;: pd.date_range(start=&#34;1949-01-01&#34;, periods=len(AirPassengers), freq=&#34;M&#34;),
</pre></div></div>
</div>
</section>
<section id="Anomaly-Model:-Taxi-passengers-in-NY">
<h1>Anomaly Model: Taxi passengers in NY<a class="headerlink" href="#Anomaly-Model:-Taxi-passengers-in-NY" title="Permalink to this heading">¶</a></h1>
<section id="Load-and-visualize-the-data">
<h2>Load and visualize the data<a class="headerlink" href="#Load-and-visualize-the-data" title="Permalink to this heading">¶</a></h2>
<p>Information on the data: - Univariate Time Series (represents the number of taxi passengers in New York) - During a period of 8 months (2014-07 to 2015-01) - Frequency of 30 minutes</p>
<p>In this example, anomalies are subjective. It can be defined as periods where the demand for taxis is abnormal (different than what should be expected). Based on this definition, the following five dates can be considered anomalies:</p>
<ul class="simple">
<li><p>NYC Marathon - 2014-11-02</p></li>
<li><p>Thanksgiving - 2014-11-27</p></li>
<li><p>Christmas - 2014-12-24/25</p></li>
<li><p>New Years - 2015-01-01</p></li>
<li><p>Snow Blizzard - 2015-01-26/27</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># load the data</span>
<span class="n">series_taxi</span> <span class="o">=</span> <span class="n">TaxiNewYorkDataset</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

<span class="c1"># define start and end dates for some known anomalies</span>
<span class="n">anomalies_day</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;NYC Marathon&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;2014-11-02 00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;2014-11-02 23:30&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Thanksgiving &quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;2014-11-27 00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;2014-11-27 23:30&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Christmas&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;2014-12-24 00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;2014-12-25 23:30&quot;</span><span class="p">),</span>
    <span class="s2">&quot;New Years&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;2014-12-31 00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;2015-01-01 23:30&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Snow Blizzard&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;2015-01-26 00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;2015-01-27 23:30&quot;</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">anomalies_day</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">k</span><span class="p">:</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">anomalies_day</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1"># create a series with the binary anomaly flags</span>
<span class="n">anomalies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">series_taxi</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">series_taxi</span><span class="o">.</span><span class="n">time_index</span><span class="p">)</span>
<span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">anomalies_day</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="n">anomalies</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">start</span> <span class="o">&lt;=</span> <span class="n">anomalies</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">anomalies</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="n">series_taxi_anomalies</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">from_series</span><span class="p">(</span><span class="n">anomalies</span><span class="p">)</span>

<span class="c1"># plot the data and the anomalies</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">series_taxi</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Number of taxi passengers&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#6464ff&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="n">series_taxi_anomalies</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;5 known anomalies&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_22-anomaly-detection-examples_10_0.png" src="../_images/examples_22-anomaly-detection-examples_10_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_anom</span><span class="p">(</span><span class="n">selected_anomaly</span><span class="p">,</span> <span class="n">delta_plotted_days</span><span class="p">):</span>
    <span class="n">one_day</span> <span class="o">=</span> <span class="n">series_taxi</span><span class="o">.</span><span class="n">freq</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="n">anomaly_date</span> <span class="o">=</span> <span class="n">anomalies_day</span><span class="p">[</span><span class="n">selected_anomaly</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">start_timestamp</span> <span class="o">=</span> <span class="n">anomaly_date</span> <span class="o">-</span> <span class="n">delta_plotted_days</span> <span class="o">*</span> <span class="n">one_day</span>
    <span class="n">end_timestamp</span> <span class="o">=</span> <span class="n">anomaly_date</span> <span class="o">+</span> <span class="p">(</span><span class="n">delta_plotted_days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">one_day</span>

    <span class="n">series_taxi</span><span class="p">[</span><span class="n">start_timestamp</span><span class="p">:</span><span class="n">end_timestamp</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Number of taxi passengers&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#6464ff&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span>
    <span class="p">)</span>

    <span class="p">(</span><span class="n">series_taxi_anomalies</span><span class="p">[</span><span class="n">start_timestamp</span><span class="p">:</span><span class="n">end_timestamp</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Known anomaly&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">selected_anomaly</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">for</span> <span class="n">anom_name</span> <span class="ow">in</span> <span class="n">anomalies_day</span><span class="p">:</span>
    <span class="n">plot_anom</span><span class="p">(</span><span class="n">anom_name</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">break</span>  <span class="c1"># remove this to see all anomalies</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_22-anomaly-detection-examples_11_0.png" src="../_images/examples_22-anomaly-detection-examples_11_0.png" />
</div>
</div>
<p>The goal would be to detect these five irregular periods and identify other possible abnormal days.</p>
</section>
<section id="Train-a-Darts-forecasting-model">
<h2>Train a Darts forecasting model<a class="headerlink" href="#Train-a-Darts-forecasting-model" title="Permalink to this heading">¶</a></h2>
<p>We will use a <code class="docutils literal notranslate"><span class="pre">SKLearnModel</span></code> to predict the number of taxi passengers. The first 4500 timestamps will be used to train the model. The training set is considered to be anomaly-free, the five considered anomalies are located after the 4500th timestamps. The number of lags is set to 1 week, assuming the demand follows a periodicity of 1 week. To help the model, additional information on the targeted series is passed as covariates (the hour and the day of the week).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># split the data in a training and testing set</span>
<span class="n">s_taxi_train</span> <span class="o">=</span> <span class="n">series_taxi</span><span class="p">[:</span><span class="mi">4500</span><span class="p">]</span>
<span class="n">s_taxi_test</span> <span class="o">=</span> <span class="n">series_taxi</span><span class="p">[</span><span class="mi">4500</span><span class="p">:]</span>

<span class="c1"># Add covariates (hour and day of the week)</span>
<span class="n">add_encoders</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;cyclic&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;future&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="s2">&quot;dayofweek&quot;</span><span class="p">]},</span>
<span class="p">}</span>

<span class="c1"># one week corresponds to (7 days * 24 hours * 2) of 30 minutes</span>
<span class="n">one_week</span> <span class="o">=</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">2</span>

<span class="n">forecasting_model</span> <span class="o">=</span> <span class="n">SKLearnModel</span><span class="p">(</span>
    <span class="n">lags</span><span class="o">=</span><span class="n">one_week</span><span class="p">,</span>
    <span class="n">lags_future_covariates</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">output_chunk_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">add_encoders</span><span class="o">=</span><span class="n">add_encoders</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">forecasting_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">s_taxi_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
SKLearnModel(lags=336, lags_past_covariates=None, lags_future_covariates=[0], output_chunk_length=1, output_chunk_shift=0, add_encoders={&#39;cyclic&#39;: {&#39;future&#39;: [&#39;hour&#39;, &#39;dayofweek&#39;]}}, model=None, multi_models=True, use_static_covariates=True)
</pre></div></div>
</div>
</section>
<section id="Use-a-Forecasting-Anomaly-Model">
<h2>Use a Forecasting Anomaly Model<a class="headerlink" href="#Use-a-Forecasting-Anomaly-Model" title="Permalink to this heading">¶</a></h2>
<p>The anomaly model consists of two inputs: - a fitted <code class="docutils literal notranslate"><span class="pre">GlobalForecastingModel</span></code> (you can find a list <a class="reference external" href="https://unit8co.github.io/darts/userguide/covariates.html#global-forecasting-models-gfms">here</a>. If the model hasn’t been fitted, set parameter <code class="docutils literal notranslate"><span class="pre">allow_model_training</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code> when calling <code class="docutils literal notranslate"><span class="pre">fit()</span></code>) - a single or list of <code class="docutils literal notranslate"><span class="pre">AnomalyScorer</span></code> (trainable or not)</p>
<p>For this example, three scorers will be used: - <code class="docutils literal notranslate"><span class="pre">NormScorer</span></code> (window is by default set to 1) - <code class="docutils literal notranslate"><span class="pre">WassersteinScorer</span></code> with a half-day window (24 timestamps) and no window aggregation - <code class="docutils literal notranslate"><span class="pre">WassersteinScorer</span></code> with a full-day window (48 timestamps) including window aggregation</p>
<p>The <code class="docutils literal notranslate"><span class="pre">window</span></code> parameter is an integer value indicating the window size used by the scorer to transform the series into an anomaly score. A scorer will slice the given series into subsequences of size W and returns a value indicating how anomalous these subset of W values are.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">window_agg</span></code> can be used to transform the window-wise scores into point-wise scores by aggregating all anomaly scores from each window that the point was included in.</p>
<p>The following figure illustrates the mechanism of a Forecasting Anomaly model:</p>
<p><img alt="8dbc9ca772e54c12a1098b168d4aa73c" class="no-scaled-link" src="../_images/ad_inside_anomaly_model.png" style="width: 800px;" /></p>
<section id="Using-the-main-functions:-fit(),-score(),-eval_metric()-and-show_anomalies()">
<h3>Using the main functions: fit(), score(), eval_metric() and show_anomalies()<a class="headerlink" href="#Using-the-main-functions:-fit(),-score(),-eval_metric()-and-show_anomalies()" title="Permalink to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># with timestamps of 30 minutes</span>
<span class="n">half_a_day</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">12</span>
<span class="n">full_day</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">24</span>

<span class="c1"># instantiate the anomaly model with: one fitted model, and 3 scorers</span>
<span class="n">anomaly_model</span> <span class="o">=</span> <span class="n">ForecastingAnomalyModel</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">forecasting_model</span><span class="p">,</span>
    <span class="n">scorer</span><span class="o">=</span><span class="p">[</span>
        <span class="n">NormScorer</span><span class="p">(</span><span class="nb">ord</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
        <span class="n">WassersteinScorer</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">half_a_day</span><span class="p">,</span> <span class="n">window_agg</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">WassersteinScorer</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">full_day</span><span class="p">,</span> <span class="n">window_agg</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now let’s train the anomaly model with <code class="docutils literal notranslate"><span class="pre">fit()</span></code>. In sequence it will:</p>
<ul class="simple">
<li><p>fit the forecasting model on the given series if it has not been fitted yet and <code class="docutils literal notranslate"><span class="pre">allow_model_training=True</span></code>.</p></li>
<li><p>generate historical forecasts for the given series.</p></li>
<li><p>feed the historical forecasts to each fittable/trainable scorer:</p>
<ul>
<li><p>compute the differences between the forecasts and the given series (controled by the scorers <code class="docutils literal notranslate"><span class="pre">diff_fn</span></code>, see Darts “per time step” metrics <a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.metrics.html">here</a>)</p></li>
<li><p>train the scorer on these differences</p></li>
</ul>
</li>
</ul>
<p>You can control how the historical forecasts are generated when calling <code class="docutils literal notranslate"><span class="pre">fit()</span></code> (the supported parameters are <a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.ad.anomaly_model.forecasting_am.html#darts.ad.anomaly_model.forecasting_am.ForecastingAnomalyModel.fit">here</a>).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">START</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">anomaly_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">s_taxi_train</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">START</span><span class="p">,</span> <span class="n">allow_model_training</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "961e3b451e6c49e6b04c4c1cd0f3aa8a", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;darts.ad.anomaly_model.forecasting_am.ForecastingAnomalyModel at 0x2905d0130&gt;
</pre></div></div>
</div>
<p>We call the function <code class="docutils literal notranslate"><span class="pre">score()</span></code> to compute the anomaly scores of a new series <code class="docutils literal notranslate"><span class="pre">s_taxi_test</span></code>. It returns the scores from each scorer in the anomaly model. We will use the results in the next section. With <code class="docutils literal notranslate"><span class="pre">return_model_prediction=True</span></code>, we can additionally get the historical forecasts generated by the forecasting model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">anomaly_scores</span><span class="p">,</span> <span class="n">model_forecasting</span> <span class="o">=</span> <span class="n">anomaly_model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span>
    <span class="n">s_taxi_test</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">START</span><span class="p">,</span> <span class="n">return_model_prediction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">pred_start</span> <span class="o">=</span> <span class="n">model_forecasting</span><span class="o">.</span><span class="n">start_time</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "50a7f565ce2a4cf6b49a69fb5cf209a0", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># compute the MAE and RMSE on the test set</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;On testing set -&gt; MAE: </span><span class="si">{</span><span class="n">mae</span><span class="p">(</span><span class="n">model_forecasting</span><span class="p">,</span><span class="w"> </span><span class="n">s_taxi_test</span><span class="p">)</span><span class="si">}</span><span class="s2">, RMSE: </span><span class="si">{</span><span class="n">rmse</span><span class="p">(</span><span class="n">model_forecasting</span><span class="p">,</span><span class="w"> </span><span class="n">s_taxi_test</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>

<span class="c1"># plot the data and the anomalies</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">s_taxi_test</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Number of taxi passengers&quot;</span><span class="p">)</span>
<span class="n">model_forecasting</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Prediction of the model&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
On testing set -&gt; MAE: 595.190366262045, RMSE: 896.6287614972252
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_22-anomaly-detection-examples_24_1.png" src="../_images/examples_22-anomaly-detection-examples_24_1.png" />
</div>
</div>
<p>To evaluate the anomaly model, we call the function <code class="docutils literal notranslate"><span class="pre">eval_metric()</span></code>. It outputs the score of an agnostic threshold metric (“AUC-ROC” or “AUC-PR”), between the predicted anomaly score time series and some known binary ground-truth time series indicating the presence of actual anomalies.</p>
<p>It will return a dictionary containing the name of the scorer and its score.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">metric_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;AUC_ROC&quot;</span><span class="p">,</span> <span class="s2">&quot;AUC_PR&quot;</span><span class="p">]</span>
<span class="n">metric_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="n">metric_names</span><span class="p">:</span>
    <span class="n">metric_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">anomaly_model</span><span class="o">.</span><span class="n">eval_metric</span><span class="p">(</span>
            <span class="n">anomalies</span><span class="o">=</span><span class="n">series_taxi_anomalies</span><span class="p">,</span>
            <span class="n">series</span><span class="o">=</span><span class="n">s_taxi_test</span><span class="p">,</span>
            <span class="n">start</span><span class="o">=</span><span class="n">START</span><span class="p">,</span>
            <span class="n">metric</span><span class="o">=</span><span class="n">metric_name</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">metric_data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">metric_names</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AUC_ROC</th>
      <th>AUC_PR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Norm (ord=1)_w=1</th>
      <td>0.658074</td>
      <td>0.215601</td>
    </tr>
    <tr>
      <th>WassersteinScorer_w=24</th>
      <td>0.884915</td>
      <td>0.609469</td>
    </tr>
    <tr>
      <th>WassersteinScorer_w=48</th>
      <td>0.950035</td>
      <td>0.687788</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>We can see that the anomaly model, using the <code class="docutils literal notranslate"><span class="pre">WassersteinScorer</span></code>, can separate the abnormal days from the normal ones. The AUC ROC is above 0.9. Additionally, a window of size 48 timestamps (24 hours) is a better option than a window of size 24 timestamps (12 hours).</p>
<p>We call the function <code class="docutils literal notranslate"><span class="pre">show_anomalies()</span></code> to visualize the results. It plots the forecasts, predicted scores, the input series, and the actual anomalies (if provided). The scorers with different windows will be separated. It is possible to compute a metric that will be shown next to the scorer’s name.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">anomaly_model</span><span class="o">.</span><span class="n">show_anomalies</span><span class="p">(</span>
    <span class="n">series</span><span class="o">=</span><span class="n">s_taxi_test</span><span class="p">,</span>
    <span class="n">anomalies</span><span class="o">=</span><span class="n">series_taxi_anomalies</span><span class="p">[</span><span class="n">pred_start</span><span class="p">:],</span>
    <span class="n">start</span><span class="o">=</span><span class="n">START</span><span class="p">,</span>
    <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;AUC_ROC&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_22-anomaly-detection-examples_29_0.png" src="../_images/examples_22-anomaly-detection-examples_29_0.png" />
</div>
</div>
</section>
</section>
</section>
<section id="Convert-an-anomaly-score-to-a-binary-prediction-with-a-Detector">
<h1>Convert an anomaly score to a binary prediction with a <code class="docutils literal notranslate"><span class="pre">Detector</span></code><a class="headerlink" href="#Convert-an-anomaly-score-to-a-binary-prediction-with-a-Detector" title="Permalink to this heading">¶</a></h1>
<p>Darts’ Anomaly Detectors convert anomaly scores into binary anomlies/predictions. In this example, we’ll use the <code class="docutils literal notranslate"><span class="pre">QuantileDetector</span></code>.</p>
<p>It detects anomalies based on the quantile values (<code class="docutils literal notranslate"><span class="pre">high_quantile</span></code> and/or <code class="docutils literal notranslate"><span class="pre">low_quantile</span></code>) of historical data. It flags times as anomalous when the values exceed these quantile thresholds. In this example, the anomaly scores were computed for the absolute residuals of the model. It is lower-bound by 0. We set <code class="docutils literal notranslate"><span class="pre">low_quantile=None</span></code> (default), as we only want to flag values above <code class="docutils literal notranslate"><span class="pre">high_quantile</span></code>.</p>
<p>We set <code class="docutils literal notranslate"><span class="pre">high_quantile</span></code> to <code class="docutils literal notranslate"><span class="pre">0.95</span></code>. This value must be chosen carefully, as it will convert the <code class="docutils literal notranslate"><span class="pre">(1-</span> <span class="pre">high_quantile)</span> <span class="pre">*</span> <span class="pre">100</span></code> % biggest anomaly scores into a prediction of anomalies. In our case, we want to see the 5% most anomalous timestamps.</p>
<blockquote>
<div><p>Note: You can also use <code class="docutils literal notranslate"><span class="pre">ThresholdDetector</span></code> to define some fixed value thresholds for anomaly detection</p>
</div></blockquote>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">darts.ad.detectors</span><span class="w"> </span><span class="kn">import</span> <span class="n">QuantileDetector</span>

<span class="n">contamination</span> <span class="o">=</span> <span class="mf">0.95</span>
<span class="n">detector</span> <span class="o">=</span> <span class="n">QuantileDetector</span><span class="p">(</span><span class="n">high_quantile</span><span class="o">=</span><span class="n">contamination</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># use the anomaly score that gave the best AUC ROC score: Wasserstein anomaly score with a window of &#39;full_day&#39;</span>
<span class="n">best_anomaly_score</span> <span class="o">=</span> <span class="n">anomaly_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># fit and detect on the anomaly scores, it will return a binary prediction</span>
<span class="n">anomaly_pred</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">fit_detect</span><span class="p">(</span><span class="n">series</span><span class="o">=</span><span class="n">best_anomaly_score</span><span class="p">)</span>

<span class="c1"># plot the binary prediction</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">anomaly_pred</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Prediction&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
<span class="n">series_taxi_anomalies</span><span class="p">[</span><span class="n">anomaly_pred</span><span class="o">.</span><span class="n">start_time</span><span class="p">()</span> <span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Known anomalies&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_22-anomaly-detection-examples_33_0.png" src="../_images/examples_22-anomaly-detection-examples_33_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">,</span> <span class="s2">&quot;precision&quot;</span><span class="p">,</span> <span class="s2">&quot;recall&quot;</span><span class="p">,</span> <span class="s2">&quot;f1&quot;</span><span class="p">]:</span>
    <span class="n">metric_val</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">eval_metric</span><span class="p">(</span>
        <span class="n">pred_scores</span><span class="o">=</span><span class="n">best_anomaly_score</span><span class="p">,</span>
        <span class="n">anomalies</span><span class="o">=</span><span class="n">series_taxi_anomalies</span><span class="p">,</span>
        <span class="n">window</span><span class="o">=</span><span class="n">full_day</span><span class="p">,</span>
        <span class="n">metric</span><span class="o">=</span><span class="n">metric_name</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metric_name</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="n">metric_val</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">/1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
accuracy: 0.91/1
precision: 0.76/1
recall: 0.32/1
f1: 0.45/1
</pre></div></div>
</div>
<p>Internally, methods <code class="docutils literal notranslate"><span class="pre">eval_metric()</span></code> and <code class="docutils literal notranslate"><span class="pre">show_anomalies()</span></code> call <code class="docutils literal notranslate"><span class="pre">eval_metric_from_scores()</span></code> and <code class="docutils literal notranslate"><span class="pre">show_anomalies_from_scores()</span></code>, respectively. We can also call them directly with pre-computed anomaly scores to avoid having to re-generate the scores each time.</p>
<p>Let’s reproduce the results from above. Both functions require the window sizes used to compute each of the anomaly scores. In our case, the window sizes were <code class="docutils literal notranslate"><span class="pre">1,</span> <span class="pre">24</span> <span class="pre">(half_a_day),</span> <span class="pre">48</span> <span class="pre">(full_day)</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">windows</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">half_a_day</span><span class="p">,</span> <span class="n">full_day</span><span class="p">]</span>
<span class="n">scorer_names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">scorer</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">w</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">scorer</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">anomaly_model</span><span class="o">.</span><span class="n">scorers</span><span class="p">,</span> <span class="n">windows</span><span class="p">)]</span>

<span class="n">metric_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;AUC_ROC&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;AUC_PR&quot;</span><span class="p">:</span> <span class="p">[]}</span>
<span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="n">metric_data</span><span class="p">:</span>
    <span class="n">metric_data</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">eval_metric_from_scores</span><span class="p">(</span>
        <span class="n">anomalies</span><span class="o">=</span><span class="n">series_taxi_anomalies</span><span class="p">,</span>
        <span class="n">pred_scores</span><span class="o">=</span><span class="n">anomaly_scores</span><span class="p">,</span>
        <span class="n">window</span><span class="o">=</span><span class="n">windows</span><span class="p">,</span>
        <span class="n">metric</span><span class="o">=</span><span class="n">metric_name</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">scorer_names</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">metric_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AUC_ROC</th>
      <th>AUC_PR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Norm (ord=1)_1</th>
      <td>0.658074</td>
      <td>0.215601</td>
    </tr>
    <tr>
      <th>WassersteinScorer_24</th>
      <td>0.884915</td>
      <td>0.609469</td>
    </tr>
    <tr>
      <th>WassersteinScorer_48</th>
      <td>0.950035</td>
      <td>0.687788</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>As expected, the AUC ROC and AUC PR values are identical to before.</p>
<p>For visualizing the anomalies:</p>
<ul class="simple">
<li><p>if we want to compute a metric, we need to specify the window sizes as well</p></li>
<li><p>optionally, we can indicate the scorers’ names that generated the scores</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_anomalies_from_scores</span><span class="p">(</span>
    <span class="n">series</span><span class="o">=</span><span class="n">s_taxi_test</span><span class="p">,</span>
    <span class="n">anomalies</span><span class="o">=</span><span class="n">series_taxi_anomalies</span><span class="p">[</span><span class="n">pred_start</span><span class="p">:],</span>
    <span class="n">pred_scores</span><span class="o">=</span><span class="n">anomaly_scores</span><span class="p">,</span>
    <span class="n">pred_series</span><span class="o">=</span><span class="n">model_forecasting</span><span class="p">,</span>
    <span class="n">window</span><span class="o">=</span><span class="n">windows</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Anomaly results using a forecasting method&quot;</span><span class="p">,</span>
    <span class="n">names_of_scorers</span><span class="o">=</span><span class="n">scorer_names</span><span class="p">,</span>
    <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;AUC_ROC&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_22-anomaly-detection-examples_40_0.png" src="../_images/examples_22-anomaly-detection-examples_40_0.png" />
</div>
</div>
</section>
<section id="A-zoom-on-each-anomalies:-visualize-the-results">
<h1>A zoom on each anomalies: visualize the results<a class="headerlink" href="#A-zoom-on-each-anomalies:-visualize-the-results" title="Permalink to this heading">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_anom_eval</span><span class="p">(</span><span class="n">selected_anomaly</span><span class="p">,</span> <span class="n">delta_plotted_days</span><span class="p">):</span>
    <span class="n">one_day</span> <span class="o">=</span> <span class="n">series_taxi</span><span class="o">.</span><span class="n">freq</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="n">anomaly_date</span> <span class="o">=</span> <span class="n">anomalies_day</span><span class="p">[</span><span class="n">selected_anomaly</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">anomaly_date</span> <span class="o">-</span> <span class="n">one_day</span> <span class="o">*</span> <span class="n">delta_plotted_days</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">anomaly_date</span> <span class="o">+</span> <span class="n">one_day</span> <span class="o">*</span> <span class="p">(</span><span class="n">delta_plotted_days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># input series and forecasts</span>
    <span class="n">series_taxi</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Number of taxi passengers&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#6464ff&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span>
    <span class="p">)</span>
    <span class="n">model_forecasting</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Model prediction&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span>
    <span class="p">)</span>

    <span class="c1"># actual anomalies and predicted scores</span>
    <span class="p">(</span><span class="n">series_taxi_anomalies</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Known anomaly&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span>
    <span class="p">)</span>
    <span class="c1"># Scaler transforms scores into a value range between (0, 1)</span>
    <span class="p">(</span><span class="n">Scaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">best_anomaly_score</span><span class="p">)[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Anomaly score&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">selected_anomaly</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">for</span> <span class="n">anom_name</span> <span class="ow">in</span> <span class="n">anomalies_day</span><span class="p">:</span>
    <span class="n">plot_anom_eval</span><span class="p">(</span><span class="n">anom_name</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">break</span>  <span class="c1"># remove this to see all anomalies</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_22-anomaly-detection-examples_42_0.png" src="../_images/examples_22-anomaly-detection-examples_42_0.png" />
</div>
</div>
</section>
<section id="Simple-case:-KMeansScorer">
<h1>Simple case: <code class="docutils literal notranslate"><span class="pre">KMeansScorer</span></code><a class="headerlink" href="#Simple-case:-KMeansScorer" title="Permalink to this heading">¶</a></h1>
<p>Let’s have a closer look at the scorer’s <code class="docutils literal notranslate"><span class="pre">window</span></code> parameter on the example of the <code class="docutils literal notranslate"><span class="pre">KmeansScorer</span></code>. We’ll use two toy datasets to demonstrate how the scorers perform with different window sizes. In first example we set <code class="docutils literal notranslate"><span class="pre">window=1</span></code> on a multivariate time series, and in the second we set <code class="docutils literal notranslate"><span class="pre">window=2</span></code> on a univariate time series.</p>
<p>The figure below illustrates the Scorer’s windowing process:</p>
<p><img alt="40ecb2648cb3452e890106353b960ffb" class="no-scaled-link" src="../_images/ad_windowing.png" style="width: 1000px;" /></p>
<section id="Multivariate-case-with-window=1">
<h2>Multivariate case with window=1<a class="headerlink" href="#Multivariate-case-with-window=1" title="Permalink to this heading">¶</a></h2>
<section id="Synthetic-data-creation">
<h3>Synthetic data creation<a class="headerlink" href="#Synthetic-data-creation" title="Permalink to this heading">¶</a></h3>
<p>The data is a multivariate series (2 components/columns). Each step has either value of <code class="docutils literal notranslate"><span class="pre">0</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span></code>, and the two components always have opposite values:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;State 1&quot;</span><span class="p">,</span> <span class="s2">&quot;State 2&quot;</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;comp1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;comp2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]})</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>comp1</th>
      <th>comp2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>State 1</th>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>State 2</th>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>At each timestamp, it has a 50% chance to switch state and a 50% chance to keep the same state.</p>
<section id="Train-set">
<h4>Train set<a class="headerlink" href="#Train-set" title="Permalink to this heading">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">generate_data_ex1</span><span class="p">(</span><span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>

    <span class="c1"># create the train set</span>
    <span class="n">comp1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">comp2</span> <span class="o">=</span> <span class="p">(</span><span class="n">comp1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">comp1</span><span class="p">,</span> <span class="n">comp2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vals</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span> <span class="o">=</span> <span class="n">generate_data_ex1</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
<span class="n">series_train</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">from_values</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;comp1&quot;</span><span class="p">,</span> <span class="s2">&quot;comp2&quot;</span><span class="p">])</span>

<span class="c1"># visualize the train set</span>
<span class="n">series_train</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Training set&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_22-anomaly-detection-examples_52_0.png" src="../_images/examples_22-anomaly-detection-examples_52_0.png" />
</div>
</div>
</section>
<section id="Test-set">
<h4>Test set<a class="headerlink" href="#Test-set" title="Permalink to this heading">¶</a></h4>
<p>We create the test set using the same rules as the train set but we’ll inject six anomalies of three different types. The anomalies can be longer than one timestamp. The types are:</p>
<ul class="simple">
<li><p>1st type: replacing the value of one component (0 or 1) with 2</p></li>
<li><p>2nd type: adding +1 or -1 to both components</p></li>
<li><p>3rd type: both components have the same value</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># inject anomalies in the test timeseries</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">generate_data_ex1</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># 2 anomalies per type</span>
<span class="c1"># type 1: random values for only one component</span>
<span class="n">data</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">data</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">32</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># type 2: shift both components values (+/- 1 for both components)</span>
<span class="n">data</span><span class="p">[</span><span class="mi">45</span><span class="p">:</span><span class="mi">47</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">data</span><span class="p">[</span><span class="mi">60</span><span class="p">:</span><span class="mi">64</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-=</span> <span class="mi">1</span>

<span class="c1"># type 3: switch one value to the another</span>
<span class="n">data</span><span class="p">[</span><span class="mi">75</span><span class="p">:</span><span class="mi">82</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">75</span><span class="p">:</span><span class="mi">82</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">data</span><span class="p">[</span><span class="mi">90</span><span class="p">:</span><span class="mi">96</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">90</span><span class="p">:</span><span class="mi">96</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

<span class="n">series_test</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">from_values</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;component 1&quot;</span><span class="p">,</span> <span class="s2">&quot;component 2&quot;</span><span class="p">])</span>

<span class="c1"># create the binary anomalies ground truth series</span>
<span class="n">anomalies</span> <span class="o">=</span> <span class="o">~</span><span class="p">((</span><span class="n">data</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">data</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">anomalies</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">from_times_and_values</span><span class="p">(</span>
    <span class="n">times</span><span class="o">=</span><span class="n">series_test</span><span class="o">.</span><span class="n">time_index</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">anomalies</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;is_anomaly&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Let’s look at the anomalies. From left to right, the first two anomalies correspond to the first type, the third and the fourth correspond to the second type, and the last two to the third type.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_anomalies_from_scores</span><span class="p">(</span>
    <span class="n">series</span><span class="o">=</span><span class="n">series_test</span><span class="p">,</span> <span class="n">anomalies</span><span class="o">=</span><span class="n">anomalies</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Testing set multivariate&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_22-anomaly-detection-examples_57_0.png" src="../_images/examples_22-anomaly-detection-examples_57_0.png" />
</div>
</div>
</section>
</section>
<section id="Use-the-scorer-KMeansScorer()">
<h3>Use the scorer <code class="docutils literal notranslate"><span class="pre">KMeansScorer()</span></code><a class="headerlink" href="#Use-the-scorer-KMeansScorer()" title="Permalink to this heading">¶</a></h3>
<p>We’ll use the <code class="docutils literal notranslate"><span class="pre">KMeansScorer</span></code> to locate the anomalies with the following parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">k</span></code>=2: The number of clusters/centroids generated by the KMeans model. We choose two since we know that there are only two valid states.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">window</span></code>=1 (default): Each timestamp is considered independently by the KMeans model. It indicates the size of the window used to create the subsequences of the series (<code class="docutils literal notranslate"><span class="pre">window</span></code> is identical to a positive target <code class="docutils literal notranslate"><span class="pre">lag</span></code> for our <a class="reference external" href="https://unit8co.github.io/darts/examples/20-SKLearnModel-examples.html#Darts-Regression-Models">regression models</a>). In this example we know that each anomaly can be detected by only looking one step.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">component_wise</span></code>=False (default): All components are used together as features with a single KMeans model. If <code class="docutils literal notranslate"><span class="pre">True</span></code>, we would fit a dedicated model per component. For this example we need information about both components to find all anomalies.</p></li>
</ul>
<p>We’ll fit <code class="docutils literal notranslate"><span class="pre">KMeansScorer</span></code> on the anomaly-free training series, compute the anomaly scores on the test series, and finally evaluate the scores.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">Kmeans_scorer</span> <span class="o">=</span> <span class="n">KMeansScorer</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">component_wise</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># fit the KmeansScorer on the train timeseries &#39;series_train&#39;</span>
<span class="n">Kmeans_scorer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">series_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;darts.ad.scorers.kmeans_scorer.KMeansScorer at 0x29a3849d0&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">anomaly_score</span> <span class="o">=</span> <span class="n">Kmeans_scorer</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">series_test</span><span class="p">)</span>

<span class="c1"># visualize the anomaly score compared to the true anomalies</span>
<span class="n">anomaly_score</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Anomaly score by KMeans&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="n">anomalies</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Anomaly score from KMeans Scorer vs true anomalies&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_22-anomaly-detection-examples_61_0.png" src="../_images/examples_22-anomaly-detection-examples_61_0.png" />
</div>
</div>
<p>Nice! We can see that the anomaly scores accurately indicate the position of the 6 anomalies.</p>
<p>To evaluate the scores, we can call <code class="docutils literal notranslate"><span class="pre">eval_metric()</span></code>. It expects the true anomalies, the series, and the name of the agnostic threshold metric (AUC-ROC or AUC-PR).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;AUC_ROC&quot;</span><span class="p">,</span> <span class="s2">&quot;AUC_PR&quot;</span><span class="p">]:</span>
    <span class="n">metric_val</span> <span class="o">=</span> <span class="n">Kmeans_scorer</span><span class="o">.</span><span class="n">eval_metric</span><span class="p">(</span><span class="n">anomalies</span><span class="p">,</span> <span class="n">series_test</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric_name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metric_name</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="n">metric_val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
AUC_ROC: 1.0
AUC_PR: 1.0
</pre></div></div>
</div>
<p>And again, let’s visualize the results with <code class="docutils literal notranslate"><span class="pre">show_anomalies()</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">Kmeans_scorer</span><span class="o">.</span><span class="n">show_anomalies</span><span class="p">(</span><span class="n">series</span><span class="o">=</span><span class="n">series_test</span><span class="p">,</span> <span class="n">anomalies</span><span class="o">=</span><span class="n">anomalies</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;AUC_ROC&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_22-anomaly-detection-examples_65_0.png" src="../_images/examples_22-anomaly-detection-examples_65_0.png" />
</div>
</div>
</section>
</section>
<section id="Univariate-case-with-window&gt;1">
<h2>Univariate case with window&gt;1<a class="headerlink" href="#Univariate-case-with-window>1" title="Permalink to this heading">¶</a></h2>
<p>In the previous example, we used <code class="docutils literal notranslate"><span class="pre">window=1</span></code> which was sufficient to identify all anomalies. In the next example, we’ll see that sometimes higher values are required to capture the true anomalies.</p>
<section id="id1">
<h3>Synthetic data creation<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h3>
<section id="id2">
<h4>Train set<a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h4>
<p>In this toy example, we generate a univariate (one component) series that can take 4 possible values.</p>
<ul class="simple">
<li><p>possible values at each step <code class="docutils literal notranslate"><span class="pre">(0,</span> <span class="pre">1,</span> <span class="pre">2,</span> <span class="pre">3)</span></code></p></li>
<li><p>every next step either adds <code class="docutils literal notranslate"><span class="pre">diff=+1</span></code> or subtracts <code class="docutils literal notranslate"><span class="pre">diff=-1</span></code> (50% chance)</p></li>
<li><p>all steps are upper- and lower-bounded</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">diff=-1</span></code> remains at <code class="docutils literal notranslate"><span class="pre">0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">3</span></code> and <code class="docutils literal notranslate"><span class="pre">diff=+1</span></code> remains at <code class="docutils literal notranslate"><span class="pre">3</span></code></p></li>
</ul>
</li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">generate_data_ex2</span><span class="p">(</span><span class="n">start_val</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>
    <span class="c1"># create the test set</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

    <span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_val</span>

    <span class="n">diffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)):</span>
        <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">diffs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">elif</span> <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">vals</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span> <span class="o">=</span> <span class="n">generate_data_ex2</span><span class="p">(</span><span class="n">start_val</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">series_train</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">from_values</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;series&quot;</span><span class="p">])</span>

<span class="c1"># visualize the train set</span>
<span class="n">series_train</span><span class="p">[:</span><span class="mi">40</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Training set&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;Training set&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_22-anomaly-detection-examples_72_1.png" src="../_images/examples_22-anomaly-detection-examples_72_1.png" />
</div>
</div>
</section>
<section id="id3">
<h4>Test set<a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h4>
<p>We create the test set using the same rules as the train set but we’ll inject six anomalies of two different types. The anomalies can be longer than one timestamp:</p>
<ul class="simple">
<li><p>Type 1: steps with <code class="docutils literal notranslate"><span class="pre">abs(diff)</span> <span class="pre">&gt;</span> <span class="pre">1</span></code> (jumps larger than one)</p></li>
<li><p>Type 2: steps with <code class="docutils literal notranslate"><span class="pre">diff</span> <span class="pre">=</span> <span class="pre">0</span></code> at values <code class="docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">2)</span></code> (value remains constant)</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span> <span class="o">=</span> <span class="n">generate_data_ex2</span><span class="p">(</span><span class="n">start_val</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># 3 anomalies per type</span>
<span class="c1"># type 1: sudden shift between state 0 to state 2 without passing by value 1</span>
<span class="n">data</span><span class="p">[</span><span class="mi">23</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">data</span><span class="p">[</span><span class="mi">44</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">data</span><span class="p">[</span><span class="mi">91</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># type 2: having consecutive timestamps at value 1 or 2</span>
<span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">data</span><span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">19</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">data</span><span class="p">[</span><span class="mi">62</span><span class="p">:</span><span class="mi">65</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">series_test</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">from_values</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;series&quot;</span><span class="p">])</span>

<span class="c1"># identify the anomalies</span>
<span class="n">diffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">anomalies</span> <span class="o">=</span> <span class="o">~</span><span class="p">((</span><span class="n">diffs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">diffs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">])))</span>
<span class="c1"># the first step is not an anomaly</span>
<span class="n">anomalies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="kc">False</span><span class="p">],</span> <span class="n">anomalies</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">anomalies</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">from_times_and_values</span><span class="p">(</span>
    <span class="n">series_test</span><span class="o">.</span><span class="n">time_index</span><span class="p">,</span> <span class="n">anomalies</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;is_anomaly&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_anomalies_from_scores</span><span class="p">(</span>
    <span class="n">series</span><span class="o">=</span><span class="n">series_test</span><span class="p">,</span> <span class="n">anomalies</span><span class="o">=</span><span class="n">anomalies</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Testing set univariate&quot;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_22-anomaly-detection-examples_76_0.png" src="../_images/examples_22-anomaly-detection-examples_76_0.png" />
</div>
</div>
<p>From left to right, anomalies at positions 3, 4, and 6 are of type 1, and anomalies at positions 1, 2, and 5 are of type 2.</p>
</section>
</section>
<section id="id4">
<h3>Use the scorer <code class="docutils literal notranslate"><span class="pre">KMeansScorer()</span></code><a class="headerlink" href="#id4" title="Permalink to this heading">¶</a></h3>
<p>We fit two <code class="docutils literal notranslate"><span class="pre">KMeansScorer</span></code> with different values for the <code class="docutils literal notranslate"><span class="pre">window</span></code> parameter (1 and 2).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">windows</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">Kmeans_scorer_w1</span> <span class="o">=</span> <span class="n">KMeansScorer</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">windows</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">Kmeans_scorer_w2</span> <span class="o">=</span> <span class="n">KMeansScorer</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">windows</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">window_agg</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">scores_all</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">metric_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;AUC_ROC&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;AUC_PR&quot;</span><span class="p">:</span> <span class="p">[]}</span>
<span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">window</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">Kmeans_scorer_w1</span><span class="p">,</span> <span class="n">Kmeans_scorer_w2</span><span class="p">],</span> <span class="n">windows</span><span class="p">):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">series_train</span><span class="p">)</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">series_test</span><span class="p">)</span>
    <span class="n">scores_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="n">metric_data</span><span class="p">:</span>
        <span class="n">metric_data</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">eval_metric_from_scores</span><span class="p">(</span>
                <span class="n">anomalies</span><span class="o">=</span><span class="n">anomalies</span><span class="p">,</span>
                <span class="n">pred_scores</span><span class="o">=</span><span class="n">scores</span><span class="p">,</span>
                <span class="n">metric</span><span class="o">=</span><span class="n">metric_name</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">metric_data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;w_1&quot;</span><span class="p">,</span> <span class="s2">&quot;w_2&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AUC_ROC</th>
      <th>AUC_PR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>w_1</th>
      <td>0.460212</td>
      <td>0.123077</td>
    </tr>
    <tr>
      <th>w_2</th>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>The metric indicates that the scorer with the parameter window set to 1 cannot locate the anomalies. On the other hand, the scorer with the parameter set to 2 perfectly identified the anomalies.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_anomalies_from_scores</span><span class="p">(</span>
    <span class="n">series</span><span class="o">=</span><span class="n">series_test</span><span class="p">,</span>
    <span class="n">anomalies</span><span class="o">=</span><span class="n">anomalies</span><span class="p">,</span>
    <span class="n">pred_scores</span><span class="o">=</span><span class="n">scores_all</span><span class="p">,</span>
    <span class="n">names_of_scorers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;KMeansScorer_w1&quot;</span><span class="p">,</span> <span class="s2">&quot;KMeansScorer_w2&quot;</span><span class="p">],</span>
    <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;AUC_ROC&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Anomaly results from KMeansScorer&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_22-anomaly-detection-examples_83_0.png" src="../_images/examples_22-anomaly-detection-examples_83_0.png" />
</div>
</div>
<p>We can see the accurate prediction of the scorer with a window of 2 compared to that of the scorer with a window of 1.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<script type="application/vnd.jupyter.widget-state+json">
{"state": {"11420627fabb4c1891b540107ff6cc5c": {"model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "model_name": "LayoutModel", "state": {}}, "3248a67fef204107937f9adf21d2e92e": {"model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "model_name": "HTMLStyleModel", "state": {"description_width": "", "font_size": null, "text_color": null}}, "3d3dbaba1e1949d6a824bfa992b16d00": {"model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "model_name": "LayoutModel", "state": {}}, "50a7f565ce2a4cf6b49a69fb5cf209a0": {"model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "model_name": "HBoxModel", "state": {"children": ["IPY_MODEL_b773316934f841c5abd7228f14af2207", "IPY_MODEL_fc2b980854b2477f86c9b55ac384d015", "IPY_MODEL_c5018cde6bf1498c98baedbc420e4fdd"], "layout": "IPY_MODEL_3d3dbaba1e1949d6a824bfa992b16d00"}}, "5908762fa8ac4efeac980a7c93c1c1c2": {"model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "model_name": "LayoutModel", "state": {}}, "7e756ee5a63242298124e54f25931206": {"model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "model_name": "LayoutModel", "state": {}}, "8346846159ca4652a50a11e3d5bfbd45": {"model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "model_name": "ProgressStyleModel", "state": {"description_width": ""}}, "86d08bca35984ba88011f596751f5341": {"model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "model_name": "ProgressStyleModel", "state": {"description_width": ""}}, "961e3b451e6c49e6b04c4c1cd0f3aa8a": {"model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "model_name": "HBoxModel", "state": {"children": ["IPY_MODEL_bda225e363fc4508a78b0f41cfd692aa", "IPY_MODEL_a4c327c0ce144c979141fae7fea7f866", "IPY_MODEL_d4584ff5c0bb48c9aca68122e2b9649c"], "layout": "IPY_MODEL_11420627fabb4c1891b540107ff6cc5c"}}, "994829c2959244ddaffc951633c6e337": {"model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "model_name": "HTMLStyleModel", "state": {"description_width": "", "font_size": null, "text_color": null}}, "a2a51dc4210d4941ab4c728dd1d1e818": {"model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "model_name": "LayoutModel", "state": {}}, "a4c327c0ce144c979141fae7fea7f866": {"model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "model_name": "FloatProgressModel", "state": {"bar_style": "success", "layout": "IPY_MODEL_7e756ee5a63242298124e54f25931206", "max": 1, "style": "IPY_MODEL_8346846159ca4652a50a11e3d5bfbd45", "value": 1}}, "a5a98280980d483fb0166f8a8e750461": {"model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "model_name": "HTMLStyleModel", "state": {"description_width": "", "font_size": null, "text_color": null}}, "b773316934f841c5abd7228f14af2207": {"model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "model_name": "HTMLModel", "state": {"layout": "IPY_MODEL_a2a51dc4210d4941ab4c728dd1d1e818", "style": "IPY_MODEL_3248a67fef204107937f9adf21d2e92e", "value": "100%"}}, "bda225e363fc4508a78b0f41cfd692aa": {"model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "model_name": "HTMLModel", "state": {"layout": "IPY_MODEL_5908762fa8ac4efeac980a7c93c1c1c2", "style": "IPY_MODEL_a5a98280980d483fb0166f8a8e750461", "value": "100%"}}, "bfe855cea3944a98abf7d014ab1af6d2": {"model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "model_name": "LayoutModel", "state": {}}, "c5018cde6bf1498c98baedbc420e4fdd": {"model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "model_name": "HTMLModel", "state": {"layout": "IPY_MODEL_f410c9c275a04af68cda7ed222aa4253", "style": "IPY_MODEL_e1cb5ebdc6bf497a97ce7081f265d08b", "value": "\u20071/1\u2007[00:00&lt;00:00,\u200764.00it/s]"}}, "d4584ff5c0bb48c9aca68122e2b9649c": {"model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "model_name": "HTMLModel", "state": {"layout": "IPY_MODEL_bfe855cea3944a98abf7d014ab1af6d2", "style": "IPY_MODEL_994829c2959244ddaffc951633c6e337", "value": "\u20071/1\u2007[00:00&lt;00:00,\u200743.19it/s]"}}, "db0985e1fe2f4b41a5579ce908fd8dac": {"model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "model_name": "LayoutModel", "state": {}}, "e1cb5ebdc6bf497a97ce7081f265d08b": {"model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "model_name": "HTMLStyleModel", "state": {"description_width": "", "font_size": null, "text_color": null}}, "f410c9c275a04af68cda7ed222aa4253": {"model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "model_name": "LayoutModel", "state": {}}, "fc2b980854b2477f86c9b55ac384d015": {"model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "model_name": "FloatProgressModel", "state": {"bar_style": "success", "layout": "IPY_MODEL_db0985e1fe2f4b41a5579ce908fd8dac", "max": 1, "style": "IPY_MODEL_86d08bca35984ba88011f596751f5341", "value": 1}}}, "version_major": 2, "version_minor": 0}
</script></section>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="11-GP-filter-examples.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Filtering and predicting using the Gaussian Process filter</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="12-Dynamic-Time-Warping-example.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Dynamic Time Warping (DTW)</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2020 - 2025, Unit8 SA (Apache 2.0 License).<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.0.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>